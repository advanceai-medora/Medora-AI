2025-05-21 15:45:35,307 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 15:45:35,548 [INFO] Successfully initialized AWS clients
2025-05-21 15:45:35,548 [ERROR] Failed to connect to MongoDB: [Errno 2] No such file or directory: '/var/www/backend/global-bundle.pem'
2025-05-21 15:46:54,259 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 15:46:54,379 [INFO] Successfully initialized AWS clients
2025-05-21 15:46:54,380 [ERROR] Failed to connect to MongoDB: [Errno 2] No such file or directory: '/var/www/backend/global-bundle.pem'
2025-05-21 15:53:00,100 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 15:53:00,226 [INFO] Successfully initialized AWS clients
2025-05-21 15:53:00,226 [ERROR] Failed to connect to MongoDB: [Errno 2] No such file or directory: '/var/www/backend/global-bundle.pem'
2025-05-21 15:57:27,538 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 15:57:27,659 [INFO] Successfully initialized AWS clients
2025-05-21 15:57:27,660 [ERROR] Failed to connect to MongoDB: [Errno 2] No such file or directory: '/var/www/backend/global-bundle.pem'
2025-05-21 15:57:28,201 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 15:57:28,323 [INFO] Successfully initialized AWS clients
2025-05-21 15:57:28,324 [ERROR] Failed to connect to MongoDB: [Errno 2] No such file or directory: '/var/www/backend/global-bundle.pem'
2025-05-21 15:57:28,875 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 15:57:29,003 [INFO] Successfully initialized AWS clients
2025-05-21 15:57:29,003 [ERROR] Failed to connect to MongoDB: [Errno 2] No such file or directory: '/var/www/backend/global-bundle.pem'
2025-05-21 15:57:29,555 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 15:57:29,678 [INFO] Successfully initialized AWS clients
2025-05-21 15:57:29,678 [ERROR] Failed to connect to MongoDB: [Errno 2] No such file or directory: '/var/www/backend/global-bundle.pem'
2025-05-21 15:57:30,225 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 15:57:30,348 [INFO] Successfully initialized AWS clients
2025-05-21 15:57:30,349 [ERROR] Failed to connect to MongoDB: [Errno 2] No such file or directory: '/var/www/backend/global-bundle.pem'
2025-05-21 15:57:30,890 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 15:57:31,018 [INFO] Successfully initialized AWS clients
2025-05-21 15:57:31,019 [ERROR] Failed to connect to MongoDB: [Errno 2] No such file or directory: '/var/www/backend/global-bundle.pem'
2025-05-21 15:57:31,571 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 15:57:31,696 [INFO] Successfully initialized AWS clients
2025-05-21 15:57:31,696 [ERROR] Failed to connect to MongoDB: [Errno 2] No such file or directory: '/var/www/backend/global-bundle.pem'
2025-05-21 15:57:32,236 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 15:57:32,360 [INFO] Successfully initialized AWS clients
2025-05-21 15:57:32,362 [ERROR] Failed to connect to MongoDB: [Errno 2] No such file or directory: '/var/www/backend/global-bundle.pem'
2025-05-21 15:57:32,907 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 15:57:33,033 [INFO] Successfully initialized AWS clients
2025-05-21 15:57:33,033 [ERROR] Failed to connect to MongoDB: [Errno 2] No such file or directory: '/var/www/backend/global-bundle.pem'
2025-05-21 15:57:33,576 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 15:57:33,698 [INFO] Successfully initialized AWS clients
2025-05-21 15:57:33,698 [ERROR] Failed to connect to MongoDB: [Errno 2] No such file or directory: '/var/www/backend/global-bundle.pem'
2025-05-21 15:57:34,256 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 15:57:34,378 [INFO] Successfully initialized AWS clients
2025-05-21 15:57:34,379 [ERROR] Failed to connect to MongoDB: [Errno 2] No such file or directory: '/var/www/backend/global-bundle.pem'
2025-05-21 15:57:34,918 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 15:57:35,045 [INFO] Successfully initialized AWS clients
2025-05-21 15:57:35,046 [ERROR] Failed to connect to MongoDB: [Errno 2] No such file or directory: '/var/www/backend/global-bundle.pem'
2025-05-21 15:57:35,586 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 15:57:35,711 [INFO] Successfully initialized AWS clients
2025-05-21 15:57:35,712 [ERROR] Failed to connect to MongoDB: [Errno 2] No such file or directory: '/var/www/backend/global-bundle.pem'
2025-05-21 15:57:36,254 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 15:57:36,378 [INFO] Successfully initialized AWS clients
2025-05-21 15:57:36,379 [ERROR] Failed to connect to MongoDB: [Errno 2] No such file or directory: '/var/www/backend/global-bundle.pem'
2025-05-21 15:57:36,934 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 15:57:37,057 [INFO] Successfully initialized AWS clients
2025-05-21 15:57:37,058 [ERROR] Failed to connect to MongoDB: [Errno 2] No such file or directory: '/var/www/backend/global-bundle.pem'
2025-05-21 15:57:37,593 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 15:57:37,714 [INFO] Successfully initialized AWS clients
2025-05-21 15:57:37,716 [ERROR] Failed to connect to MongoDB: [Errno 2] No such file or directory: '/var/www/backend/global-bundle.pem'
2025-05-21 16:01:58,563 [INFO] Logging setup complete. Logs will be written to /var/www/medora-web-backend/flask-app.log and console.
2025-05-21 16:01:58,687 [INFO] Successfully initialized AWS clients
2025-05-21 16:01:58,797 [INFO] Created indexes on tenantId fields in MongoDB collections
2025-05-21 16:01:58,797 [INFO] Successfully connected to MongoDB
2025-05-21 16:01:58,845 [INFO] Successfully loaded private key for IMS FHIR authentication
2025-05-21 16:01:58,854 [INFO] MongoDB indexes created successfully
2025-05-21 16:02:14,117 [INFO] Fetching patients for tenant_id: doctor@allergyaffiliates.com
2025-05-21 16:02:14,121 [INFO] Found 0 patients for tenant doctor@allergyaffiliates.com
2025-05-21 16:02:16,791 [INFO] Fetching patients for tenant_id: doctor@allergyaffiliates.com
2025-05-21 16:02:16,793 [INFO] Found 0 patients for tenant doctor@allergyaffiliates.com
2025-05-21 16:02:33,965 [INFO] Fetching patients for tenant_id: doctor@allergyaffiliates.com
2025-05-21 16:02:33,967 [INFO] Found 0 patients for tenant doctor@allergyaffiliates.com
2025-05-21 16:02:36,812 [INFO] Fetching patients for tenant_id: doctor@allergyaffiliates.com
2025-05-21 16:02:36,814 [INFO] Found 0 patients for tenant doctor@allergyaffiliates.com
2025-05-21 16:03:00,367 [INFO] Fetching patients for tenant_id: siddharthc@meditab.com
2025-05-21 16:03:00,370 [INFO] Found 0 patients for tenant siddharthc@meditab.com
2025-05-21 16:03:03,014 [INFO] Fetching patients for tenant_id: siddharthc@meditab.com
2025-05-21 16:03:03,016 [INFO] Found 0 patients for tenant siddharthc@meditab.com
2025-05-21 16:03:11,783 [INFO] Fetching patients for tenant_id: doctor@allergyaffiliates.com
2025-05-21 16:03:11,786 [INFO] Found 0 patients for tenant doctor@allergyaffiliates.com
2025-05-21 16:03:14,441 [INFO] Fetching patients for tenant_id: doctor@allergyaffiliates.com
2025-05-21 16:03:14,443 [INFO] Found 0 patients for tenant doctor@allergyaffiliates.com
2025-05-21 16:03:17,827 [INFO] Handling POST request for /api/visit/start
2025-05-21 16:03:17,830 [INFO] Patient TEST01 not found, creating new patient
2025-05-21 16:03:17,836 [INFO] Created new patient with ID: 682df945cdc7223ac94f81e1
2025-05-21 16:03:17,844 [INFO] Visit started: c264f461-3adf-445e-9d10-411c45b5bd5d for patient 682df945cdc7223ac94f81e1 by doctor@allergyaffiliates.com
2025-05-21 16:03:19,159 [INFO] Fetching patients for tenant_id: doctor@allergyaffiliates.com
2025-05-21 16:03:19,161 [INFO] Found 1 patients for tenant doctor@allergyaffiliates.com
2025-05-21 16:03:19,218 [INFO] Fetching history for patient 682df945cdc7223ac94f81e1 in tenant doctor@allergyaffiliates.com
2025-05-21 16:03:19,220 [INFO] Retrieved 0 transcripts for patient 682df945cdc7223ac94f81e1 in tenant doctor@allergyaffiliates.com
2025-05-21 16:03:46,160 [INFO] Received request for /api/analyze-transcript
2025-05-21 16:03:46,161 [INFO] Handling POST request for /api/analyze-transcript
2025-05-21 16:03:46,161 [INFO] Processing transcript with data: patient_id=682df945cdc7223ac94f81e1, visit_id=c264f461-3adf-445e-9d10-411c45b5bd5d, tenant_id=doctor@allergyaffiliates.com, email=doctor@allergyaffiliates.com
2025-05-21 16:03:46,161 [INFO] Generating SOAP notes via xAI API
2025-05-21 16:04:01,342 [INFO] Raw xAI response: ```json
{
    "patient_history": {
        "chief_complaint": "Hives due to seafood and shellfish allergies, ongoing for an unspecified duration, severity not specified.",
        "history_of_present_illness": "Pankaj reports experiencing hives, which he attributes to his known seafood and shellfish allergies. The onset, duration, and frequency of these episodes are not specified in the transcript. He does not mention specific triggers beyond seafood and shellfish, associated symptoms, or the impact on his daily life. Pankaj is currently undergoing allergy shots, but it is unclear if these are helping or if he has tried other treatments.",
        "past_medical_history": "No specific past medical history, hospitalizations, surgeries, or chronic conditions mentioned. Prior allergy management includes ongoing allergy shots, but details such as duration and effectiveness are not provided.",
        "allergies": "Seafood and shellfish allergies with hives as the reported reaction. Current management includes allergy shots, specifics unknown.",
        "social_history": "No information provided on lifestyle factors, occupation, smoking/alcohol history, or environmental exposures.",
        "review_of_systems": "No additional symptoms mentioned across other systems such as fatigue, fever, or weight changes."
    },
    "physical_examination": "Physical examination is needed to assess the presence and extent of hives, as well as any other signs of allergic reactions.",
    "differential_diagnosis": "Primary Diagnosis: Allergic reaction to seafood and shellfish. Alternative Diagnoses: 1) Chronic urticaria unrelated to food allergies, 2) Contact dermatitis from other allergens.",
    "diagnostic_workup": "1. Skin prick test to confirm seafood and shellfish allergies. 2. Complete blood count (CBC) with differential to rule out other causes of hives. 3. Serum tryptase level to assess for mast cell activation. Rationale: These tests will help confirm the allergic nature of the hives and rule out other potential causes.",
    "plan_of_care": "In regards to Allergic reaction to seafood and shellfish:\n- Continue allergy shots if effective, with a review of their efficacy at the next visit.\n- Prescribe second-generation antihistamines such as cetirizine 10 mg daily for symptom control.\n- Educate on strict avoidance of seafood and shellfish.\nIn regards to Chronic urticaria:\n- Prescribe a trial of H1 and H2 antihistamine combination, e.g., cetirizine 10 mg and ranitidine 150 mg twice daily.\n- Consider referral to a dermatologist if symptoms persist.\nIn regards to Contact dermatitis:\n- Identify and avoid potential contact allergens.\n- Use topical corticosteroids such as hydrocortisone 1% cream as needed.\nIn regards to Follow-Up:\n- Schedule a follow-up appointment in 4 weeks to assess response to treatment and review allergy shot progress.\nIn regards to Emergency Management:\n- Prescribe an EpiPen (epinephrine auto-injector) and educate on its use for severe allergic reactions.",
    "patient_education": "Educate Pankaj on the importance of avoiding seafood and shellfish, recognizing signs of an allergic reaction, and the proper use of an EpiPen. Discuss the importance of adhering to the prescribed medication regimen and the potential need for ongoing allergy shots.",
    "follow_up_instructions": "Follow up in 4 weeks to review symptom control, effectiveness of allergy shots, and any side effects from medications. Bring a symptom diary to the appointment.",
    "summary": "Pankaj presented with hives attributed to seafood and shellfish allergies. He is currently on allergy shots, but their effectiveness is unclear. A detailed diagnostic workup is planned, and a comprehensive treatment plan including medications and emergency management has been outlined. Follow-up in 4 weeks is scheduled.",
    "enhanced_recommendations": "1. Medication Management:\n   - Cetirizine 10 mg orally once daily for hives. Rationale: Second-generation antihistamines are effective for allergic urticaria with minimal sedative effects.\n   - Ranitidine 150 mg orally twice daily if chronic urticaria is suspected. Rationale: H2 blockers can enhance the effect of H1 blockers in chronic urticaria.\n   - EpiPen (epinephrine auto-injector) 0.3 mg intramuscularly as needed for severe allergic reactions. Rationale: Essential for anaphylaxis management.\n   - Medication interactions: Cetirizine may interact with CNS depressants; monitor for increased sedation. Ranitidine may interact with certain antacids; avoid concurrent use.\n   - Adjustment protocol: Increase cetirizine to 20 mg daily if symptoms persist after 2 weeks. If no improvement, consider adding ranitidine.\n\n2. Lifestyle Modifications:\n   - Implement strict avoidance of seafood and shellfish in all forms, including cross-contamination risks in restaurants.\n   - Use hypoallergenic products to reduce the risk of contact dermatitis.\n   - Dietary adjustments: Avoid processed foods that may contain hidden seafood derivatives.\n   - Exercise: No specific restrictions, but monitor for exercise-induced urticaria.\n   - Stress management: Practice mindfulness or yoga to reduce stress, which can exacerbate hives.\n\n3. Monitoring Protocol:\n   - Monitor frequency and severity of hives daily using a symptom diary.\n   - Check for signs of anaphylaxis such as difficulty breathing or swelling.\n   - Contact healthcare provider if hives persist despite treatment or if new symptoms develop.\n   - Use a smartphone app like 'MySymptoms' for digital tracking.\n\n4. Emergency Action Plan:\n   - Use EpiPen if experiencing severe symptoms such as difficulty breathing, swelling of the face or throat, or severe hives.\n   - Call emergency services immediately after using the EpiPen.\n   - Caregivers should be trained on EpiPen use and emergency protocol.\n\n5. Long-term Management Strategy:\n   - Reassess treatment efficacy at 3 months, then every 6 months.\n   - Goal: Complete resolution of hives and no need for emergency interventions.\n   - Future options: Immunotherapy adjustments, biologics if refractory to current treatments.\n   - Success criteria: No hives for 6 months, no emergency interventions.\n   - Referral: Consider allergist or dermatologist referral if symptoms persist beyond 6 months.\n\n6. Patient Education Resources:\n   - 'Understanding Food Allergies' by the American Academy of Allergy, Asthma & Immunology.\n   - Food Allergy Research & Education (FARE) website: www.foodallergy.org.\n   - Support group: Local allergy support group, contact through the hospital's patient services.\n   - Mobile app: 'Allergy Alert' for managing food allergies.\n\n7. Follow-up Schedule:\n   - 4 weeks post-visit to review initial treatment response.\n   - 3 months for comprehensive review and potential adjustment of immunotherapy.\n   - Bring symptom diary and any new test results to follow-up appointments.\n   - Expectation: Significant reduction in hives frequency and severity by the 3-month follow-up."
}
```
2025-05-21 16:04:01,343 [INFO] Parsed JSON: {'patient_history': {'chief_complaint': 'Hives due to seafood and shellfish allergies, ongoing for an unspecified duration, severity not specified.', 'history_of_present_illness': 'Pankaj reports experiencing hives, which he attributes to his known seafood and shellfish allergies. The onset, duration, and frequency of these episodes are not specified in the transcript. He does not mention specific triggers beyond seafood and shellfish, associated symptoms, or the impact on his daily life. Pankaj is currently undergoing allergy shots, but it is unclear if these are helping or if he has tried other treatments.', 'past_medical_history': 'No specific past medical history, hospitalizations, surgeries, or chronic conditions mentioned. Prior allergy management includes ongoing allergy shots, but details such as duration and effectiveness are not provided.', 'allergies': 'Seafood and shellfish allergies with hives as the reported reaction. Current management includes allergy shots, specifics unknown.', 'social_history': 'No information provided on lifestyle factors, occupation, smoking/alcohol history, or environmental exposures.', 'review_of_systems': 'No additional symptoms mentioned across other systems such as fatigue, fever, or weight changes.'}, 'physical_examination': 'Physical examination is needed to assess the presence and extent of hives, as well as any other signs of allergic reactions.', 'differential_diagnosis': 'Primary Diagnosis: Allergic reaction to seafood and shellfish. Alternative Diagnoses: 1) Chronic urticaria unrelated to food allergies, 2) Contact dermatitis from other allergens.', 'diagnostic_workup': '1. Skin prick test to confirm seafood and shellfish allergies. 2. Complete blood count (CBC) with differential to rule out other causes of hives. 3. Serum tryptase level to assess for mast cell activation. Rationale: These tests will help confirm the allergic nature of the hives and rule out other potential causes.', 'plan_of_care': 'In regards to Allergic reaction to seafood and shellfish:\n- Continue allergy shots if effective, with a review of their efficacy at the next visit.\n- Prescribe second-generation antihistamines such as cetirizine 10 mg daily for symptom control.\n- Educate on strict avoidance of seafood and shellfish.\nIn regards to Chronic urticaria:\n- Prescribe a trial of H1 and H2 antihistamine combination, e.g., cetirizine 10 mg and ranitidine 150 mg twice daily.\n- Consider referral to a dermatologist if symptoms persist.\nIn regards to Contact dermatitis:\n- Identify and avoid potential contact allergens.\n- Use topical corticosteroids such as hydrocortisone 1% cream as needed.\nIn regards to Follow-Up:\n- Schedule a follow-up appointment in 4 weeks to assess response to treatment and review allergy shot progress.\nIn regards to Emergency Management:\n- Prescribe an EpiPen (epinephrine auto-injector) and educate on its use for severe allergic reactions.', 'patient_education': 'Educate Pankaj on the importance of avoiding seafood and shellfish, recognizing signs of an allergic reaction, and the proper use of an EpiPen. Discuss the importance of adhering to the prescribed medication regimen and the potential need for ongoing allergy shots.', 'follow_up_instructions': 'Follow up in 4 weeks to review symptom control, effectiveness of allergy shots, and any side effects from medications. Bring a symptom diary to the appointment.', 'summary': 'Pankaj presented with hives attributed to seafood and shellfish allergies. He is currently on allergy shots, but their effectiveness is unclear. A detailed diagnostic workup is planned, and a comprehensive treatment plan including medications and emergency management has been outlined. Follow-up in 4 weeks is scheduled.', 'enhanced_recommendations': "1. Medication Management:\n   - Cetirizine 10 mg orally once daily for hives. Rationale: Second-generation antihistamines are effective for allergic urticaria with minimal sedative effects.\n   - Ranitidine 150 mg orally twice daily if chronic urticaria is suspected. Rationale: H2 blockers can enhance the effect of H1 blockers in chronic urticaria.\n   - EpiPen (epinephrine auto-injector) 0.3 mg intramuscularly as needed for severe allergic reactions. Rationale: Essential for anaphylaxis management.\n   - Medication interactions: Cetirizine may interact with CNS depressants; monitor for increased sedation. Ranitidine may interact with certain antacids; avoid concurrent use.\n   - Adjustment protocol: Increase cetirizine to 20 mg daily if symptoms persist after 2 weeks. If no improvement, consider adding ranitidine.\n\n2. Lifestyle Modifications:\n   - Implement strict avoidance of seafood and shellfish in all forms, including cross-contamination risks in restaurants.\n   - Use hypoallergenic products to reduce the risk of contact dermatitis.\n   - Dietary adjustments: Avoid processed foods that may contain hidden seafood derivatives.\n   - Exercise: No specific restrictions, but monitor for exercise-induced urticaria.\n   - Stress management: Practice mindfulness or yoga to reduce stress, which can exacerbate hives.\n\n3. Monitoring Protocol:\n   - Monitor frequency and severity of hives daily using a symptom diary.\n   - Check for signs of anaphylaxis such as difficulty breathing or swelling.\n   - Contact healthcare provider if hives persist despite treatment or if new symptoms develop.\n   - Use a smartphone app like 'MySymptoms' for digital tracking.\n\n4. Emergency Action Plan:\n   - Use EpiPen if experiencing severe symptoms such as difficulty breathing, swelling of the face or throat, or severe hives.\n   - Call emergency services immediately after using the EpiPen.\n   - Caregivers should be trained on EpiPen use and emergency protocol.\n\n5. Long-term Management Strategy:\n   - Reassess treatment efficacy at 3 months, then every 6 months.\n   - Goal: Complete resolution of hives and no need for emergency interventions.\n   - Future options: Immunotherapy adjustments, biologics if refractory to current treatments.\n   - Success criteria: No hives for 6 months, no emergency interventions.\n   - Referral: Consider allergist or dermatologist referral if symptoms persist beyond 6 months.\n\n6. Patient Education Resources:\n   - 'Understanding Food Allergies' by the American Academy of Allergy, Asthma & Immunology.\n   - Food Allergy Research & Education (FARE) website: www.foodallergy.org.\n   - Support group: Local allergy support group, contact through the hospital's patient services.\n   - Mobile app: 'Allergy Alert' for managing food allergies.\n\n7. Follow-up Schedule:\n   - 4 weeks post-visit to review initial treatment response.\n   - 3 months for comprehensive review and potential adjustment of immunotherapy.\n   - Bring symptom diary and any new test results to follow-up appointments.\n   - Expectation: Significant reduction in hives frequency and severity by the 3-month follow-up."}
2025-05-21 16:04:01,343 [INFO] Generated SOAP notes: {
  "patient_history": {
    "chief_complaint": "Hives due to seafood and shellfish allergies, ongoing for an unspecified duration, severity not specified.",
    "history_of_present_illness": "Pankaj reports experiencing hives, which he attributes to his known seafood and shellfish allergies. The onset, duration, and frequency of these episodes are not specified in the transcript. He does not mention specific triggers beyond seafood and shellfish, associated symptoms, or the impact on his daily life. Pankaj is currently undergoing allergy shots, but it is unclear if these are helping or if he has tried other treatments.",
    "past_medical_history": "No specific past medical history, hospitalizations, surgeries, or chronic conditions mentioned. Prior allergy management includes ongoing allergy shots, but details such as duration and effectiveness are not provided.",
    "allergies": "Seafood and shellfish allergies with hives as the reported reaction. Current management includes allergy shots, specifics unknown.",
    "social_history": "No information provided on lifestyle factors, occupation, smoking/alcohol history, or environmental exposures.",
    "review_of_systems": "No additional symptoms mentioned across other systems such as fatigue, fever, or weight changes."
  },
  "physical_examination": "Physical examination is needed to assess the presence and extent of hives, as well as any other signs of allergic reactions.",
  "differential_diagnosis": "Primary Diagnosis: Allergic reaction to seafood and shellfish. Alternative Diagnoses: 1) Chronic urticaria unrelated to food allergies, 2) Contact dermatitis from other allergens.",
  "diagnostic_workup": "1. Skin prick test to confirm seafood and shellfish allergies. 2. Complete blood count (CBC) with differential to rule out other causes of hives. 3. Serum tryptase level to assess for mast cell activation. Rationale: These tests will help confirm the allergic nature of the hives and rule out other potential causes.",
  "plan_of_care": "In regards to Allergic reaction to seafood and shellfish:\n- Continue allergy shots if effective, with a review of their efficacy at the next visit.\n- Prescribe second-generation antihistamines such as cetirizine 10 mg daily for symptom control.\n- Educate on strict avoidance of seafood and shellfish.\nIn regards to Chronic urticaria:\n- Prescribe a trial of H1 and H2 antihistamine combination, e.g., cetirizine 10 mg and ranitidine 150 mg twice daily.\n- Consider referral to a dermatologist if symptoms persist.\nIn regards to Contact dermatitis:\n- Identify and avoid potential contact allergens.\n- Use topical corticosteroids such as hydrocortisone 1% cream as needed.\nIn regards to Follow-Up:\n- Schedule a follow-up appointment in 4 weeks to assess response to treatment and review allergy shot progress.\nIn regards to Emergency Management:\n- Prescribe an EpiPen (epinephrine auto-injector) and educate on its use for severe allergic reactions.",
  "patient_education": "Educate Pankaj on the importance of avoiding seafood and shellfish, recognizing signs of an allergic reaction, and the proper use of an EpiPen. Discuss the importance of adhering to the prescribed medication regimen and the potential need for ongoing allergy shots.",
  "follow_up_instructions": "Follow up in 4 weeks to review symptom control, effectiveness of allergy shots, and any side effects from medications. Bring a symptom diary to the appointment.",
  "summary": "Pankaj presented with hives attributed to seafood and shellfish allergies. He is currently on allergy shots, but their effectiveness is unclear. A detailed diagnostic workup is planned, and a comprehensive treatment plan including medications and emergency management has been outlined. Follow-up in 4 weeks is scheduled.",
  "enhanced_recommendations": "1. Medication Management:\n   - Cetirizine 10 mg orally once daily for hives. Rationale: Second-generation antihistamines are effective for allergic urticaria with minimal sedative effects.\n   - Ranitidine 150 mg orally twice daily if chronic urticaria is suspected. Rationale: H2 blockers can enhance the effect of H1 blockers in chronic urticaria.\n   - EpiPen (epinephrine auto-injector) 0.3 mg intramuscularly as needed for severe allergic reactions. Rationale: Essential for anaphylaxis management.\n   - Medication interactions: Cetirizine may interact with CNS depressants; monitor for increased sedation. Ranitidine may interact with certain antacids; avoid concurrent use.\n   - Adjustment protocol: Increase cetirizine to 20 mg daily if symptoms persist after 2 weeks. If no improvement, consider adding ranitidine.\n\n2. Lifestyle Modifications:\n   - Implement strict avoidance of seafood and shellfish in all forms, including cross-contamination risks in restaurants.\n   - Use hypoallergenic products to reduce the risk of contact dermatitis.\n   - Dietary adjustments: Avoid processed foods that may contain hidden seafood derivatives.\n   - Exercise: No specific restrictions, but monitor for exercise-induced urticaria.\n   - Stress management: Practice mindfulness or yoga to reduce stress, which can exacerbate hives.\n\n3. Monitoring Protocol:\n   - Monitor frequency and severity of hives daily using a symptom diary.\n   - Check for signs of anaphylaxis such as difficulty breathing or swelling.\n   - Contact healthcare provider if hives persist despite treatment or if new symptoms develop.\n   - Use a smartphone app like 'MySymptoms' for digital tracking.\n\n4. Emergency Action Plan:\n   - Use EpiPen if experiencing severe symptoms such as difficulty breathing, swelling of the face or throat, or severe hives.\n   - Call emergency services immediately after using the EpiPen.\n   - Caregivers should be trained on EpiPen use and emergency protocol.\n\n5. Long-term Management Strategy:\n   - Reassess treatment efficacy at 3 months, then every 6 months.\n   - Goal: Complete resolution of hives and no need for emergency interventions.\n   - Future options: Immunotherapy adjustments, biologics if refractory to current treatments.\n   - Success criteria: No hives for 6 months, no emergency interventions.\n   - Referral: Consider allergist or dermatologist referral if symptoms persist beyond 6 months.\n\n6. Patient Education Resources:\n   - 'Understanding Food Allergies' by the American Academy of Allergy, Asthma & Immunology.\n   - Food Allergy Research & Education (FARE) website: www.foodallergy.org.\n   - Support group: Local allergy support group, contact through the hospital's patient services.\n   - Mobile app: 'Allergy Alert' for managing food allergies.\n\n7. Follow-up Schedule:\n   - 4 weeks post-visit to review initial treatment response.\n   - 3 months for comprehensive review and potential adjustment of immunotherapy.\n   - Bring symptom diary and any new test results to follow-up appointments.\n   - Expectation: Significant reduction in hives frequency and severity by the 3-month follow-up.",
  "recommendations": "1. Medication Management:\n   - Cetirizine 10 mg orally once daily for hives. Rationale: Second-generation antihistamines are effective for allergic urticaria with minimal sedative effects.\n   - Ranitidine 150 mg orally twice daily if chronic urticaria is suspected. Rationale: H2 blockers can enhance the effect of H1 blockers in chronic urticaria.\n   - EpiPen (epinephrine auto-injector) 0.3 mg intramuscularly as needed for severe allergic reactions. Rationale: Essential for anaphylaxis management.\n   - Medication interactions: Cetirizine may interact with CNS depressants; monitor for increased sedation. Ranitidine may interact with certain antacids; avoid concurrent use.\n   - Adjustment protocol: Increase cetirizine to 20 mg daily if symptoms persist after 2 weeks. If no improvement, consider adding ranitidine.\n\n2. Lifestyle Modifications:\n   - Implement strict avoidance of seafood and shellfish in all forms, including cross-contamination risks in restaurants.\n   - Use hypoallergenic products to reduce the risk of contact dermatitis.\n   - Dietary adjustments: Avoid processed foods that may contain hidden seafood derivatives.\n   - Exercise: No specific restrictions, but monitor for exercise-induced urticaria.\n   - Stress management: Practice mindfulness or yoga to reduce stress, which can exacerbate hives.\n\n3. Monitoring Protocol:\n   - Monitor frequency and severity of hives daily using a symptom diary.\n   - Check for signs of anaphylaxis such as difficulty breathing or swelling.\n   - Contact healthcare provider if hives persist despite treatment or if new symptoms develop.\n   - Use a smartphone app like 'MySymptoms' for digital tracking.\n\n4. Emergency Action Plan:\n   - Use EpiPen if experiencing severe symptoms such as difficulty breathing, swelling of the face or throat, or severe hives.\n   - Call emergency services immediately after using the EpiPen.\n   - Caregivers should be trained on EpiPen use and emergency protocol.\n\n5. Long-term Management Strategy:\n   - Reassess treatment efficacy at 3 months, then every 6 months.\n   - Goal: Complete resolution of hives and no need for emergency interventions.\n   - Future options: Immunotherapy adjustments, biologics if refractory to current treatments.\n   - Success criteria: No hives for 6 months, no emergency interventions.\n   - Referral: Consider allergist or dermatologist referral if symptoms persist beyond 6 months.\n\n6. Patient Education Resources:\n   - 'Understanding Food Allergies' by the American Academy of Allergy, Asthma & Immunology.\n   - Food Allergy Research & Education (FARE) website: www.foodallergy.org.\n   - Support group: Local allergy support group, contact through the hospital's patient services.\n   - Mobile app: 'Allergy Alert' for managing food allergies.\n\n7. Follow-up Schedule:\n   - 4 weeks post-visit to review initial treatment response.\n   - 3 months for comprehensive review and potential adjustment of immunotherapy.\n   - Bring symptom diary and any new test results to follow-up appointments.\n   - Expectation: Significant reduction in hives frequency and severity by the 3-month follow-up."
}
2025-05-21 16:04:01,344 [INFO] Storing SOAP notes in MedoraSOAPNotes for patient_id: 682df945cdc7223ac94f81e1, visit_id: c264f461-3adf-445e-9d10-411c45b5bd5d, tenant_id: doctor@allergyaffiliates.com
2025-05-21 16:04:01,404 [INFO] Successfully stored SOAP notes in MedoraSOAPNotes for tenant doctor@allergyaffiliates.com
2025-05-21 16:04:01,405 [INFO] Preparing to save transcript for patient 682df945cdc7223ac94f81e1 with tenant doctor@allergyaffiliates.com
2025-05-21 16:04:01,446 [INFO] Stored transcript for patient 682df945cdc7223ac94f81e1, tenant doctor@allergyaffiliates.com: Inserted ID 682df971cdc7223ac94f81e3
2025-05-21 16:04:01,509 [INFO] Fetching history for patient 682df945cdc7223ac94f81e1 in tenant doctor@allergyaffiliates.com
2025-05-21 16:04:01,511 [INFO] Retrieved 1 transcripts for patient 682df945cdc7223ac94f81e1 in tenant doctor@allergyaffiliates.com
2025-05-21 16:04:01,569 [INFO] ALLERGENIQ: API endpoint called
2025-05-21 16:04:01,570 [INFO] ALLERGENIQ: Request details: {'method': 'GET', 'url': 'http://medoramd.ai/api/allergeniq-profile?patient_id=682df945cdc7223ac94f81e1&visit_id=c264f461-3adf-445e-9d10-411c45b5bd5d&email=doctor@allergyaffiliates.com&tenantID=allergyaffiliates', 'headers': {'Host': 'medoramd.ai', 'X-Real-Ip': '108.191.130.223', 'X-Forwarded-For': '108.191.130.223', 'X-Forwarded-Proto': 'https', 'Connection': 'close', 'Sec-Ch-Ua-Platform': '"macOS"', 'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/136.0.0.0 Safari/537.36', 'Sec-Ch-Ua': '"Chromium";v="136", "Google Chrome";v="136", "Not.A/Brand";v="99"', 'Content-Type': 'application/json', 'Sec-Ch-Ua-Mobile': '?0', 'Accept': '*/*', 'Sec-Fetch-Site': 'same-origin', 'Sec-Fetch-Mode': 'cors', 'Sec-Fetch-Dest': 'empty', 'Referer': 'https://medoramd.ai/index.html', 'Accept-Encoding': 'gzip, deflate, br, zstd', 'Accept-Language': 'en-US,en;q=0.9', 'Cookie': '_tccl_visitor=0c2d81c9-9198-4dff-975d-d52b1b60d377'}, 'args': {'patient_id': '682df945cdc7223ac94f81e1', 'visit_id': 'c264f461-3adf-445e-9d10-411c45b5bd5d', 'email': 'doctor@allergyaffiliates.com', 'tenantID': 'allergyaffiliates'}, 'remote_addr': '127.0.0.1'}
2025-05-21 16:04:01,570 [INFO] Converting default_tenant to email: doctor@allergyaffiliates.com
2025-05-21 16:04:01,570 [INFO] ALLERGENIQ: Request params - patient_id: 682df945cdc7223ac94f81e1, visit_id: c264f461-3adf-445e-9d10-411c45b5bd5d, tenant_id: doctor@allergyaffiliates.com, email: doctor@allergyaffiliates.com
2025-05-21 16:04:01,577 [INFO] ALLERGENIQ: SOAP notes retrieval result: True
2025-05-21 16:04:01,585 [INFO] Found 0 insights for patient 682df945cdc7223ac94f81e1 using GSI
2025-05-21 16:04:01,586 [INFO] ALLERGENIQ: Retrieved 0 patient insights
2025-05-21 16:04:01,589 [INFO] ALLERGENIQ: Processing transcript for allergy data
2025-05-21 16:04:01,590 [INFO] ALLERGENIQ: Successfully processed transcript for allergen data
2025-05-21 16:04:01,590 [INFO] ALLERGENIQ: Structuring profile data
2025-05-21 16:04:01,593 [INFO] ALLERGENIQ: Found patient: TEST01, age: None
2025-05-21 16:04:01,596 [INFO] ALLERGENIQ: Found visit date: 2025-05-21
2025-05-21 16:04:01,596 [INFO] ALLERGENIQ: Successfully generated profile data
2025-05-21 16:04:01,649 [INFO] Received request for /get-insights
2025-05-21 16:04:01,650 [INFO] Handling GET request for /get-insights
2025-05-21 16:04:01,650 [INFO] Parsed diagnoses for patient_id 682df945cdc7223ac94f81e1: ['Primary Diagnosis: Allergic reaction to seafood and shellfish']
2025-05-21 16:04:02,078 [INFO] Fetched 1 clinical guidelines for condition: Primary Diagnosis: Allergic reaction to seafood and shellfish
2025-05-21 16:04:02,771 [ERROR] Error querying PubMed for condition Primary Diagnosis: Allergic reaction to seafood and shellfish: 'NoneType' object has no attribute 'lower'
2025-05-21 16:04:03,061 [ERROR] Error querying Semantic Scholar for condition Primary Diagnosis: Allergic reaction to seafood and shellfish: 'NoneType' object has no attribute 'lower'
2025-05-21 16:04:03,062 [INFO] Final response for patient_id 682df945cdc7223ac94f81e1: {
  "patient_id": "682df945cdc7223ac94f81e1",
  "visit_id": "c264f461-3adf-445e-9d10-411c45b5bd5d",
  "insights": [
    {
      "title": "ACVIM consensus statement: Guidelines for the identification, evaluation, and management of systemic hypertension in dogs and cats.",
      "summary": "An update to the 2007 American College of Veterinary Internal Medicine (ACVIM) consensus statement on the identification, evaluation, and management of systemic hypertension in dogs and cats was presented at the 2017 ACVIM Forum in National Harbor, MD. The updated consensus statement is presented here. The consensus statement aims to provide guidance on appropriate diagnosis and treatment of hypertension in dogs and cats.",
      "url": "https://pubmed.ncbi.nlm.nih.gov/30353952/",
      "source": "Journal of veterinary internal medicine",
      "authors": "Mark J Acierno, Scott Brown, Amanda E Coleman, Rosanne E Jepson, Mark Papich, Rebecca L Stepien, Harriet M Syme",
      "year": "2018",
      "content_type": "Clinical Guideline",
      "relevance_tag": "Clinical Practice Guideline for Primary Diagnosis: Allergic reaction to seafood and shellfish",
      "confidence": "Highly Recommended",
      "relevance_score": "95.0%"
    }
  ]
}
2025-05-21 16:04:03,074 [INFO] Stored reference e8f52656-8be3-4098-83e0-51ec34d3d24a for patient 682df945cdc7223ac94f81e1, tenant default_tenant
2025-05-21 16:04:15,583 [INFO] Deleted patient 682df945cdc7223ac94f81e1 and associated data in tenant doctor@allergyaffiliates.com
2025-05-21 16:07:06,901 [INFO] Fetching patients for tenant_id: doctor@allergyaffiliates.com
2025-05-21 16:07:06,909 [INFO] Found 0 patients for tenant doctor@allergyaffiliates.com
2025-05-21 16:07:09,534 [INFO] Fetching patients for tenant_id: doctor@allergyaffiliates.com
2025-05-21 16:07:09,536 [INFO] Found 0 patients for tenant doctor@allergyaffiliates.com
